<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <record id="paperformat_vat_retention" model="report.paperformat">
      <field name="margin_top">5</field>
      <field name="margin_bottom">5</field>
      <field name="name">VAT Retention Report</field>
      <field name="orientation">Landscape</field>
      <field name="header_line" eval="False"/>
    </record>

    <template id="template_vat_wh_voucher">
      <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
          <t t-call="web.basic_layout" t-lang="es_VE">

            <!-- Header -->
            <div style="margin:0 0 40px;">
              <table style="width:100%;" class="table table-borderless">
                <tr>
                  <td style="width:16%; vertical-align:top; padding:0;">
                    <t t-if="o.company_id.logo">
                      <img t-attf-src="data:image/png;base64,{{ o.company_id.logo }}" style="max-height:140px; max-width:160px;"/>
                    </t>
                  </td>
                  <td style="width:60%; text-align:center; padding:0 10px; vertical-align:middle;">
                    <h1 style="margin:0; font-size:24px;">COMPROBANTE DE RETENCIÓN<br/>DEL IMPUESTO AL VALOR AGREGADO</h1>
                    <p style="font-size:10px; margin:4px 0; line-height:1.2;">LEY IVA – ART. 11: “SERÁN RESPONSABLES DEL PAGO DE IMPUESTO EN CALIDAD DE AGENTES DE RETENCIÓN, LOS COMPRADORES O ADQUIRIENTES DE DETERMINADOS BIENES MUEBLES Y LOS RECEPTORES<br/>DE CIERTOS SERVICIOS A QUIENES LA ADMINISTRACIÓN TRIBUTARIA DESIGNE COMO TAL”</p>
                  </td>
                  <td style="width:24%; text-align:right; vertical-align:top; padding:0;">
                    <p style="margin:0; font-size:12px;"><strong>Nro Comprobante:</strong> <t t-esc="o.name"/></p>
                    <p style="margin:2px 0; font-size:12px;"><strong>Período Fiscal:</strong> <t t-esc="o.periodo()"/></p>
                    <p style="margin:2px 0; font-size:12px;"><strong>Fecha:</strong> <t t-esc="o.formato_fecha2()"/></p>
                  </td>
                </tr>
              </table>
            </div>

            <!-- Agent section -->
            <div style="margin-bottom:20px;">
              <table style="width:100%; border:2px solid #000; border-collapse:collapse; font-size:12px;" class="table table-sm">
                <tr>
                  <th colspan="3" style="padding:8px; text-align:left; background-color:transparent;">AGENTE DE RETENCIÓN</th>
                </tr>
                <tr>
                  <td style="padding:8px; border:2px solid #000; width:33%;"><strong>Nombre o Razón Social:</strong> <t t-esc="o.company_id.name"/></td>
                  <td style="padding:8px; border:2px solid #000; width:33%;"><strong>RIF:</strong> <t t-esc="o.company_id.vat"/></td>
                  <td style="padding:8px; border:2px solid #000; width:34%;"><strong>Dirección Fiscal:</strong> <t t-esc="o.company_id.street"/></td>
                </tr>
              </table>
            </div>

            <!-- Beneficiary section -->
            <div style="margin-bottom:20px;">
              <table style="width:100%; border:2px solid #000; border-collapse:collapse; font-size:12px;" class="table table-sm">
                <tr>
                  <th colspan="3" style="padding:8px; text-align:left; background-color:transparent;">DATOS DEL BENEFICIARIO</th>
                </tr>
                <tr>
                  <td style="padding:8px; border:2px solid #000; width:33%;"><strong>Nombre o Razón Social:</strong> <t t-esc="o.partner_id.name"/></td>
                  <td style="padding:8px; border:2px solid #000; width:33%;"><strong>RIF:</strong> <t t-esc="o.partner_id.vat"/></td>
                  <td style="padding:8px; border:2px solid #000; width:34%;"><strong>Dirección Fiscal:</strong> <t t-esc="o.partner_id.street"/></td>
                </tr>
              </table>
            </div>

            <!-- Detail table: small font, auto layout -->
            <div style="width:100%;">
              <table style="width:100%; border-collapse:collapse; font-size:10px; table-layout:auto; text-align:center;" class="table table-sm">
                <thead style="background-color:#a9dede; color:#000;">
                  <tr>
                    <th style="padding:4px; white-space:normal; text-align:center;">Fecha<br/>Oper.</th>
                    <th style="padding:4px; white-space:normal;">N°<br/>Factura</th>
                    <th style="padding:4px; white-space:normal;">N°<br/>Control</th>
                    <th style="padding:4px; white-space:normal;">N° Nota<br/>Débito</th>
                    <th style="padding:4px; white-space:normal;">N° Nota<br/>Crédito</th>
                    <th style="padding:4px; white-space:normal;">Tipo<br/>Trans.</th>
                    <th style="padding:4px; white-space:normal;">N° Afect.<br/>Factura</th>
                    <th style="padding:4px; white-space:normal;">Total<br/>c/IVA</th>
                    <th style="padding:4px; white-space:normal;">Compras<br/>sin Créd.</th>
                    <th style="padding:4px; white-space:normal;">Base<br/>Imponible</th>
                    <th style="padding:4px; white-space:normal;">%<br/>Alic.</th>
                    <th style="padding:4px; white-space:normal;">Imp.<br/>Causado</th>
                    <th style="padding:4px; white-space:normal;">Base<br/>Reduc.</th>
                    <th style="padding:4px; white-space:normal;">%<br/>Reduc.</th>
                    <th style="padding:4px; white-space:normal;">Imp.<br/>Reduc.</th>
                    <th style="padding:4px; white-space:normal;">Base<br/>Adic.</th>
                    <th style="padding:4px; white-space:normal;">Imp.<br/>Adic.</th>
                    <th style="padding:4px; white-space:normal;">%<br/>Adic.</th>
                    <th style="padding:4px; white-space:normal;">%<br/>Ret.</th>
                    <th style="padding:4px; white-space:normal;">Imp.<br/>Retenido</th>
                  </tr>
                </thead>
                <tbody>
                  <t t-foreach="o.retention_line_ids" t-as="line">
                    <tr>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.invoice_id.invoice_date"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.invoice_number"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.invoice_id.invoice_number_control"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.debit_note_number or ''"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.credit_note_number or ''"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.tipo_trans"/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.factura_afectada"/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.total_factura" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.exento" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.base_imponible" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.alicuota"/>%</td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.impuesto" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.base_reducido" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.alicuota_reducido"/>%</td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.impuesto_reducido" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.base_adicional" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.impuesto_adicional" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.alicuota_adicional"/>%</td>
                      <td style="padding:4px; text-align:center;"><t t-esc="line.retention_rate"/>%</td>
                      <td style="padding:4px; text-align:right;"><t t-esc="line.retention_amount" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                    </tr>
                  </t>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="19" style="padding:4px; text-align:right;"><strong>Total General:</strong></td>
                    <td style="padding:4px; text-align:right;"><t t-esc="o.vat_retentioned" t-options='{"widget":"monetary","display_currency":o.currency_id}'/></td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- Signatures -->
            <div class="row" style="font-size:16px; margin-top:40px;">
              <div class="col-6 text-center">
                <div style="border-bottom:1px solid #000; width:80%; margin:auto;"></div>
                <span t-esc="o.company_id.name" style="display:block; margin-top:8px;"/>Firma Agente de Retención
              </div>
              <div class="col-6 text-center">
                <div style="border-bottom:1px solid #000; width:80%; margin:auto;"></div>
                <span t-esc="o.partner_id.name" style="display:block; margin-top:8px;"/>Firma Beneficiario
              </div>
            </div>

          </t>
        </t>
      </t>
    </template>

    <record id="action_iva_ret_report" model="ir.actions.report">
      <field name="name">Comprobante de IVA</field>
      <field name="model">vat.retention</field>
      <field name="report_type">qweb-pdf</field>
      <field name="report_name">iva_retention.template_vat_wh_voucher</field>
      <field name="report_file">iva_retention.template_vat_wh_voucher</field>
      <field name="binding_type">report</field>
      <field name="paperformat_id" ref="paperformat_vat_retention"/>
    </record>
  </data>
</odoo>
