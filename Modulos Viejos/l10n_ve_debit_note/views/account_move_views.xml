<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Inserta un único botón “Nota de Débito” que despacha ventas o compras -->
  <record id="view_move_form_debit_note" model="ir.ui.view">
    <field name="name">account.move.form.debit.note</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="account.view_move_form"/>
    <field name="priority" eval="100"/>
    <field name="arch" type="xml">
      <xpath expr="//header" position="inside">
        <button name="action_open_debit_note"
                string="Nota de Débito"
                type="object"
                class="btn-secondary"
                groups="sale.group_sale_manager,purchase.group_purchase_manager"
                modifiers='{"invisible":[
                  "|",
                  ["|",
                    ["move_type","!=","out_invoice"],
                    ["move_type","!=","in_invoice"]
                  ],
                  ["amount_residual","=",0]
                ]}'/>
      </xpath>
    </field>
  </record>
</odoo>
